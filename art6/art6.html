<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../art_main.css">
    <title>MyBlog | 【Python】左クリックカウンター</title>
</head>
<body>
    <header>
    </header>

    <div class="main">
        <h2>【Python】左クリックカウンター</h2>

        <div class="cont">
        <h3>はじめに</h3>
        <p>
        本格的にプログラムを勉強し始めてから半年ほど経ちました。
        少しずつ自分の思った通りのプログラムを作れるようになってきて、上達の実感を感じてきています。<br>
        ある日僕は思いました。
        </p>
        
        <h4>"一日に何回左クリックしているのだろうか?"</h4>

        <p>
        大学も春休み入ったため、暇つぶし程度に左クリックをカウントするプログラムを作ることにしました。<br>
        さらにLINEのAPIを使って、毎日決まった時間に左クリックした回数を自動で送信する機能も実装しようと思います。
        </p>

        <h3>要件定義</h3>
        <p>
        今回は0:00:00から23:59:40までに左クリックした回数をカウントし、23:59:50にLINEでその回数を
        送信するというプログラムを作成します。実装する具体的な機能は次のようなものになります。
        </p>
        <ol>
        <li><p>クリック回数のカウント、LINEでの送信などすべての処理を完全自動で行うようにする。</p></li>
        <li><p>「左クリックカウンター」というLINEアカウントで回数の送信を行う。</p></li>
        </ol>
        <p>
        なお今回は複数のスクリプトファイルを作成して1つのシステムを構築しています。
        システムを構成するファイルの名前と役割はこのようになっています。
        </p>

        <img src="1.jpg">
        

        <h3>プログラムの仕組み(click_counter.py)</h3>
        <div class="code">
            <script src="https://gist.github.com/taoka8810/00af1951d63c8845ee76bfdd37f888d5.js"></script>
        </div>
        <p>
        まず初めに0:00:00にタスクスケジューラによってstart.batが実行され、click_counter.pyが起動します。
        click_counter.pyでは左クリックを検知し、その回数をrecord.xlsxに記録する機能があります。
        左クリックの検知方法にはWindows APIの「GetAsyncKeyState」を使用しました。
        これをそのままif文に組み込むと、クロック周波数に合わせて回数が記録されてしまうため、
        一瞬しかクリックして内のにも関わらず数百回もカウントされてしまいます。
        これを防ぐためにマウスの左ボタンを押してから離すまでで1カウントとなるように設計しました。<br><br>

        またこのプログラムは23:59:40に自動で停止するようになっています。
        プログラムを停止しなければ、line.pyがrecord.xlsxにアクセスできなくなってしまうためです。
        一連の処理が完了したらstart.batによって再び実行されます。
        </p>

        <h3>プログラムの仕組み(line.py)</h3>
        <div class="code">
            <script src="https://gist.github.com/taoka8810/eeb49b4056a5ea264b57333fa22270d0.js"></script>
        </div>
        <p>
        このプログラムを作成する前にLINE DevelopersにログインしてMessaging APIを使うための
        botの設定を行いました。その後、発行されたアクセストークンとユーザIDをinfo.jsonに書きました。<br><br>
       
        プログラムの方では、まずinfo.jsonとrecord.xlsxをロードします。info.jsonからはアクセストークンとユーザIDを取り出します。
        この2つはMessaging APIを利用するために必要になります。record.xlsxからはクリックした回数を取り出します。
        この2つの情報を使ってクリックした回数をLINEで送信します。プログラムはタスクスケジューラで23:59:50に自動で実行されるように設定しています。
        </p>

        <h3>実行結果</h3>
        <img src="3.jpg">
        <p>
        このシステムを稼働させている間は、毎日23:59に上の画像のようなメッセージが届きます。<br>
        ※上の写真は実験用でスクショしたものなので17:37になっています。<br>
        1週間ほど稼働させましたが、放置していても毎日メッセージがちゃんと送信されてきているため、
        正常に動作していると思います。
        </p>

        <h3>まとめ</h3>
        <p>
        プログラムを作りしばらく稼働させました。その結果、僕は一日に約3000回左クリックをしていることが分かりました。
        意外と多くて驚きました。またプログラムを作る中でAPIを初めて使用し、その理解を深めることができました。
        今回はLINEのAPIを使用しましたが、実はTwitterのAPIを使って毎日決まった時間にクリックした回数をツイートするというアイデアもありました。
        しかしTwitterのAPIを取得するのに時間がかかっているため、後で実装できたらと思います。<br><br>
        </p>
        

        




        </div>
    </div>

</body>
</html>